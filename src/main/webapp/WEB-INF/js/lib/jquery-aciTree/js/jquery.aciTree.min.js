
/*
 * aciTree jQuery Plugin v3.0.0-rc.1
 * http://acoderinsights.ro
 *
 * Copyright (c) 2013 Dragos Ursu
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Require jQuery Library >= v1.7.1 http://jquery.com
 * + aciPlugin >= v1.1.1 https://github.com/dragosu/jquery-aciPlugin
 *
 * Date: Fri Mar 22 19:10 2013 +0200
 */

// core
(function(b){var a={jsonUrl:null,rootData:null,threads:4,queueDelay:40,loaderDelay:500,expand:false,collapse:false,unique:false,empty:false,show:{props:{height:"show"},duration:"medium",easing:"linear"},animateRoot:true,hide:{props:{height:"hide"},duration:"medium",easing:"linear"},view:{duration:"medium",easing:"linear"},callbacks:{item:null}};var c={__extend:function(){b.extend(this._instance,{locked:false});b.extend(this._private,{loadQueue:new this._queue(this._instance.options.threads,false,this._instance.options.queueDelay),loaderHide:null,loaderInterval:null,delayBusy:0})},init:function(){var g=this;if(this.wasInit()){this._trigger(null,"wasinit");return false}if(this.isLocked()){this._trigger(null,"locked");return false}this._instance.locked=true;this._instance.jQuery.bind("mousedown"+this._instance.nameSpace,function(i){var h=b(i.target);if(h.is(".aciTreeButton,.aciTreeLoad,.aciTreeLi,.aciTreeIcon")){g._instance.jQuery.focus();i.preventDefault()}}).on("click"+this._instance.nameSpace,".aciTreeButton",function(i){var h=g.itemFrom(i.target);if(g.isBusy(h)){return}g.toggle(h,{collapse:g._instance.options.collapse,expand:g._instance.options.expand,unique:g._instance.options.unique})});this._initHook();var e=this._super;var f=function(){e.apply(g);g._instance.locked=false;g._trigger(null,"init")};var d=function(){e.apply(g);g._instance.locked=false;g._trigger(null,"initfail")};if(this._instance.options.rootData){this.loadFrom(null,{success:f,fail:d,itemData:this._instance.options.rootData})}else{if(this._instance.options.jsonUrl){this.ajaxLoad(null,{success:f,fail:d})}else{f()}}return true},_initHook:function(){},isLocked:function(){return this._instance.locked},_queue:function(i,d,g){var h=[];var k=[];var e=i?Math.max(i,1):1;var j=0;var f=false;this.push=function(m,l){if(!f){h.push({callback:m,async:l})}return this};this.complete=function(m,l){if(!f){k.push({callback:m,async:l})}return this};this.destroy=function(){f=true;setTimeout(function(){k=[];h=[];j=0;f=false},g)};this.busy=function(){return j>=e};this.empty=function(){return(j==0)&&(h.length==0)&&(k.length==0)};this.run=function(o){if((j>=e)||f){return}if(o){for(var n=1,m=e-j;n<m;n++){this.run()}}var l=this;setTimeout(function(){if((j>=e)||f){return}var p=h.shift();if(!p){if(h.length){setTimeout(function(){l.run()},10)}else{p=k.shift()}}if(p){if(p.async){j++;p.callback(function(){j--;l.run()})}else{j++;p.callback();j--;l.run()}}},d?10:g)}},_options:function(f,h,d,g){var e=b.extend({success:null,fail:null,notify:null,expand:false,collapse:false,unique:false,unanimated:false,itemData:null},f);if(h){if(f&&f.success){e.success=function(){h();f.success()}}else{e.success=h}}if(d){if(f&&f.fail){e.fail=function(){d();f.fail()}}else{e.fail=d}}if(g){if(f&&f.notify){e.notify=function(){g();f.notify()}}else{if(!e.notify&&f&&f.success){e.notify=function(){g();f.success()}}else{e.notify=g}}}else{if(!e.notify&&f&&f.success){e.notify=f.success}}return e},_trigger:function(e,d,f){f=b.extend({event:d},f);this._instance.jQuery.trigger("acitree",[this,e?e.first():null,f])},_success:function(e,d,f){if(d&&d.success){d.success.call(this,e?e.first():null,f)}},_fail:function(e,d,f){if(d&&d.fail){d.fail.call(this,e?e.first():null,f)}},_notify:function(e,d,f){if(d&&d.notify){d.notify.call(this,e?e.first():null,f)}},_delayBusy:function(d,g){var f=this;if((this._private.delayBusy<10)&&this.isBusy(d)){this._private.delayBusy++;var e=this._private;setTimeout(function(){f._delayBusy.call(f,d,g);e.delayBusy--},10);return}g()},ajaxLoad:function(e,d){var f=this;if(e&&this.isBusy(e)){this._delayBusy(e,function(){f.ajaxLoad(e,d)});return}d=this._options(d,function(){f._loading(e);f._trigger(e,"loaded")},function(){f._loading(e);f._trigger(e,"loadfail")},function(){f._loading(e);f._trigger(e,"wasloaded")});if(!e||this.isFolder(e)){this._private.loadQueue.push(function(g){f._loading(e,true);if(f.wasLoad(e)){f._notify(e,d);g();return}b.get(f._instance.options.jsonUrl+(e?f.getId(e):""),function(h){if(h&&(h instanceof Array)&&h.length){var i=function(){if(f.wasLoad(e)){f.unload(e,{success:function(){f._createBranch(e,h);f._success(e,d);g()},fail:function(){f._fail(e,d);g()},unanimated:d.unanimated})}else{f._createBranch(e,h);f._success(e,d);g()}};if(f.isFolder(e)){i()}else{f.setFolder(e,{success:i,fail:i})}}else{var i=function(){f._fail(e,d);g()};if(f.isFile(e)){i()}else{f.setFile(e,{success:i,fail:i})}}},"json").fail(function(){f._fail(e,d);g()})},true).run()}else{this._fail(e,d)}},loadFrom:function(e,d){var g=this;if(e&&this.isBusy(e)){this._delayBusy(e,function(){g.loadFrom(e,d)});return}d=this._options(d,function(){g._loading(e);g._trigger(e,"loaded")},function(){g._loading(e);g._trigger(e,"loadfail")},function(){g._loading(e);g._trigger(e,"wasloaded")});if(!e||this.isFolder(e)){this._loading(e,true);if(this.wasLoad(e)){this._notify(e,d);return}if(d.itemData&&(d.itemData instanceof Array)&&d.itemData.length){var f=function(){if(g.wasLoad(e)){g.unload(e,{success:function(){g._createBranch(e,d.itemData);g._success(e,d)},fail:d.fail,unanimated:d.unanimated})}else{g._createBranch(e,d.itemData);g._success(e,d)}};if(this.isFolder(e)){f()}else{this.setFolder(e,{success:f,fail:f})}}else{if(this.isFile(e)){this._fail(e,d)}else{this.setFile(e,{success:d.fail,fail:d.fail})}}}else{this._fail(e,d)}},unload:function(e,d){var f=this;d=this._options(d,function(){f._loading(e);f._trigger(e,"unloaded")},function(){f._loading(e);f._trigger(e,"unloadfail")},function(){f._loading(e);f._trigger(e,"notloaded")});if(!e||this.isFolder(e)){this._loading(e,true);if(!this.wasLoad(e)){f._notify(e,d);return}this.childrens(e,true).each(function(){var g=b(this);if(f.isFolder(g)){if(f.isOpen(g)){f._trigger(g,"closed")}if(f.wasLoad(g)){f._trigger(g,"unloaded")}}f._trigger(g,"removed")});if(e){if(this.isOpen(e)){this.close(e,{success:function(){e.first().children(".aciTreeUl").remove();f._success(e,d)},fail:d.fail,unanimated:d.unanimated})}else{e.first().children(".aciTreeUl").remove();this._success(e,d)}}else{this._animate(e,false,!this._instance.options.animateRoot||d.unanimated,function(){f._instance.jQuery.children(".aciTreeUl").remove();f._success(e,d)})}}else{this._fail(e,d)}},remove:function(e,d){var f=this;d=this._options(d,function(){f._trigger(e,"removed")},function(){f._trigger(e,"removefail")});if(this.isItem(e)){if(this.isFolder(e)&&this.wasLoad(e)){this.unload(e,{success:function(){f._success(e,d);e.first().remove()},fail:d.fail,unanimated:d.unanimated})}else{this._success(e,d);e.first().remove()}}else{this._fail(e,d)}},_openChilds:function(f,e){var g=this;if(e.expand){var d=new this._queue(this._instance.options.threads,true,this._instance.options.queueDelay);this.folders(this.childrens(f),false).each(function(){var h=b(this);d.push(function(i){g.open(h,{success:i,fail:i,expand:true,unanimated:e.unanimated})},true)});d.complete(function(){g._success(f,e)}).run(true)}else{this._success(f,e)}},_openItem:function(e,d){var f=this;if(!d.unanimated&&!this.isVisible(e)){d.unanimated=true}if(d.unique){this.closeOthers(e);d.unique=false}e.first().addClass("aciTreeOpen");this._animate(e,true,d.unanimated,function(){f._openChilds(e,d)})},open:function(e,d){var f=this;d=this._options(d,function(){f._trigger(e,"opened")},function(){f._trigger(e,"openfail")},function(){f._trigger(e,"wasopened")});if(this.isFolder(e)){if(this.isOpen(e)){d.success=d.notify;this._openChilds(e,d)}else{if(this.wasLoad(e)){this._openItem(e,d)}else{this.ajaxLoad(e,{success:function(){f._openItem(e,d)},fail:d.fail})}}}else{this._fail(e,d)}},_closeChilds:function(f,e){var g=this;if(this._instance.options.empty){e.unanimated=true;this.unload(f,e)}else{if(e.collapse){var d=new this._queue(this._instance.options.threads,true,this._instance.options.queueDelay);this.folders(this.childrens(f),true).each(function(){var h=b(this);d.push(function(i){g.close(h,{success:i,fail:i,collapse:true,unanimated:true})},true)});d.complete(function(){g._success(f,e)}).run(true)}else{this._success(f,e)}}},_closeItem:function(e,d){var f=this;if(!d.unanimated&&!this.isVisible(e)){d.unanimated=true}e.first().removeClass("aciTreeOpen");this._animate(e,false,d.unanimated,function(){f._closeChilds(e,d)})},close:function(e,d){var f=this;d=this._options(d,function(){f._trigger(e,"closed")},function(){f._trigger(e,"closefail")},function(){f._trigger(e,"wasclosed")});if(this.isFolder(e)){if(this.isOpen(e)){this._closeItem(e,d)}else{if(this.wasLoad(e)){d.success=d.notify;this._closeChilds(e,d)}else{this._notify(e,d)}}}else{this._fail(e,d)}},closeOthers:function(g,f){var h=this;f=this._options(f);if(this.isItem(g)){var d=new this._queue(this._instance.options.threads,true,this._instance.options.queueDelay);var e=g.first().add(this.path(g)).add(this.childrens(g,true));this.folders(this.childrens(null,true),true).not(e).each(function(){var i=b(this);d.push(function(j){h.close(i,{success:j,fail:j,unanimated:f.unanimated})},true)});d.complete(function(){h._success(g,f)}).run(true)}else{this._fail(g,f)}},toggle:function(e,d){var f=this;d=this._options(d,function(){f._trigger(e,"toggled")},function(){f._trigger(e,"togglefail")});if(this.isFolder(e)){if(this.isOpen(e)){this.close(e,d)}else{this.open(e,d)}}else{this._fail(e,d)}},path:function(e,d){if(e){var f=e.first().parentsUntil(this._instance.jQuery,".aciTreeLi");return d?f:b(f.get().reverse())}return b([])},isVisible:function(g){if(g){if(this.folders(this.path(g),false).length){return false}var f=this._instance.jQuery.get(0).getBoundingClientRect();var e=g.first().children(".aciTreeItem");var h=e.get(0).getBoundingClientRect();var d=e.outerHeight(true);if((h.bottom-d<f.top)||(h.top+d>f.bottom)||(h.right<f.left)||(h.left>f.right)){return false}return true}return false},openPath:function(f,e){var g=this;e=this._options(e);if(this.isItem(f)){var d=new this._queue(null,true,this._instance.options.queueDelay);this.folders(this.path(f),false).each(function(){var h=b(this);d.push(function(i){g.open(h,{success:i,fail:i,unanimated:e.unanimated})},true)});d.complete(function(){g._success(f,e)}).run()}else{this._fail(f,e)}},_speedFraction:function(f,d,g){if((g<d)&&d){var e=parseInt(f);if(isNaN(e)){switch(f){case"slow":e=600;break;case"medium":e=400;break;case"fast":e=200;break;default:return f}}return e*g/d}return f},setVisible:function(e,d){var g=this;d=this._options(d,function(){g._trigger(e,"visible")},null,function(){g._trigger(e,"wasvisible")});if(this.isVisible(e)){this._notify(e,d)}else{if(this.isItem(e)){var f=function(){var j=g._instance.jQuery.get(0).getBoundingClientRect();var i=e.first().children(".aciTreeItem");var l=i.get(0).getBoundingClientRect();var h=i.outerHeight(true);if(l.bottom-h<j.top){var k=j.top-l.bottom+h;if(!d.unanimated&&g._instance.options.view){g._instance.jQuery.stop(true).animate({scrollTop:g._instance.jQuery.scrollTop()-k},{duration:g._speedFraction(g._instance.options.view.duration,j.bottom-j.top,k),easing:g._instance.options.view.easing,complete:function(){g._success(e,d)}})}else{g._instance.jQuery.stop(true).get(0).scrollTop=g._instance.jQuery.scrollTop()-k;g._success(e,d)}}else{if(l.top+h>j.bottom){var k=l.top-j.bottom+h;if(!d.unanimated&&g._instance.options.view){g._instance.jQuery.stop(true).animate({scrollTop:g._instance.jQuery.scrollTop()+k},{duration:g._speedFraction(g._instance.options.view.duration,j.bottom-j.top,k),easing:g._instance.options.view.easing,complete:function(){g._success(e,d)}})}else{g._instance.jQuery.stop(true).get(0).scrollTop=g._instance.jQuery.scrollTop()+k;g._success(e,d)}}else{g._success(e,d)}}};if(this.hasParent(e)){this.openPath(e,{success:f,fail:d.fail})}else{f()}}else{this._fail(e,d)}}},hasParent:function(d){return d&&(d.first().parent().parent(".aciTreeLi").length>0)},parent:function(d){return d?d.first().parent().parent(".aciTreeLi"):b([])},topParent:function(d){return this.path(d).eq(0)},_createBranch:function(h,e){if(h){h.first().removeClass("aciTreeFolderMaybe").addClass("aciTreeFolder")}var f=this.append(h,{itemData:e});var d;for(var g in e){d=e[g];if(d.items&&(d.items instanceof Array)&&d.items.length){this._createBranch(f.eq(g),d.items)}if(d.props&&d.props.open){this.open(f.eq(g))}}},_itemHook:function(e,f,d,g){if(this._instance.options.callbacks&&this._instance.options.callbacks.item){this._instance.options.callbacks.item.call(this,e,f,d,g)}},_createLi:function(e){var d=b('<li class="aciTreeLi"></li>').data("itemData"+this._instance.nameSpace,{id:e.id,item:e.item,props:e.props});var f='<div class="aciTreeButton"><div></div></div><div class="aciTreeItem">';if(e.props&&e.props.icon){if(e.props.icon instanceof Array){f+='<div class="aciTreeIcon '+e.props.icon[0]+'" style="background-position:'+e.props.icon[1]+"px "+e.props.icon[2]+'px"></div>'}else{f+='<div class="aciTreeIcon '+e.props.icon+'"></div>'}}d.append(f+'<div class="aciTreeText">'+e.item+"</div></div>");if(e.props&&(e.props.isFolder||(e.props.isFolder===null))){d.addClass((e.props.isFolder||(e.items&&e.items.length))?"aciTreeFolder":"aciTreeFolderMaybe")}else{d.addClass("aciTreeFile")}return d},_createItems:function(h,k,e,f,d){if(f){var l;if(h){l=this.itemFrom(h)}else{if(k){l=this.parent(k)}else{if(e){l=this.parent(e)}}}var j=[],m;if(f instanceof Array){for(var g in f){m=this._createLi(f[g]);this._itemHook(l,m,f[g],d);j[j.length]=m.get(0)}}else{m=this._createLi(f);this._itemHook(l,m,f,d);j[j.length]=m.get(0)}j=b(j);if(h){h.append(j)}else{if(k){k.first().before(j)}else{if(e){e.first().after(j)}}}return j}return b([])},_ensureUl:function(e){var d=e.first().children(".aciTreeUl");if(!d.length){d=b('<ul class="aciTreeUl" style="display:none"></ul>');e.first().append(d)}return d},append:function(f,d){var h=this;d=this._options(d,function(){h._trigger(f,"appended")},function(){h._trigger(f,"appendfail")});if(f){if(this.isFolder(f)){var e=this._ensureUl(f);var g=this._createItems(e,null,null,d.itemData,this.level(f)+1);if(g.length){f.first().addClass("aciTreeFolder").removeClass("aciTreeFolderMaybe");g.each(function(){h._trigger(b(this),"added")})}else{if(!this.hasChildrens(f)){e.remove()}}this._success(f,d);return g}else{this._fail(f,d);return b([])}}else{var e=this._ensureUl(this._instance.jQuery);var g=this._createItems(e,null,null,d.itemData,0);if(g.length){this._animate(null,true,!this._instance.options.animateRoot||d.unanimated);g.each(function(){h._trigger(b(this),"added")})}else{if(!this.hasChildrens()){e.remove()}}this._success(f,d);return g}},before:function(e,d){var g=this;d=this._options(d,function(){g._trigger(e,"before")},function(){g._trigger(e,"beforefail")});if(this.isItem(e)){var f=this._createItems(null,e,null,d.itemData,this.level(e));f.each(function(){g._trigger(b(this),"added")});this._success(e,d);return f}else{this._fail(e,d);return b([])}},after:function(e,d){var g=this;d=this._options(d,function(){g._trigger(e,"after")},function(){g._trigger(e,"afterfail")});if(this.isItem(e)){var f=this._createItems(null,null,e,d.itemData,this.level(e));f.each(function(){g._trigger(b(this),"added")});this._success(e,d);return f}else{this._fail(e,d);return b([])}},itemFrom:function(d){if(d){var e=b(d).first();if(e.get(0)==this._instance.jQuery.get(0)){return b([])}else{if(e.hasClass("aciTreeLi")){return e}else{return e.parents(".aciTreeLi:first")}}}return b([])},childrens:function(e,d){if(!e){e=this._instance.jQuery}return d?e.first().find(".aciTreeLi"):e.first().children(".aciTreeUl").children(".aciTreeLi")},folders:function(d,e){if(typeof e!="undefined"){if(e){return d.filter(".aciTreeOpen")}else{return d.filter(".aciTreeFolder,.aciTreeFolderMaybe").not(".aciTreeOpen")}}return d.filter(".aciTreeFolder,.aciTreeFolderMaybe")},files:function(d){return d.filter(".aciTreeFile")},isFolder:function(d){return d&&(d.first().hasClass("aciTreeFolder")||d.first().hasClass("aciTreeFolderMaybe"))},isFile:function(d){return d&&d.first().hasClass("aciTreeFile")},wasLoad:function(d){if(!d){return this._instance.jQuery.children(".aciTreeUl").length>0}if(this.isFolder(d)){return d.first().children(".aciTreeUl").length>0}return true},setFolder:function(e,d){var f=this;d=this._options(d,function(){f._trigger(e,"folderset")},null,function(){f._trigger(e,"wasfolder")});if(this.isItem(e)){if(this.isFile(e)){e.first().removeClass("aciTreeFile").addClass("aciTreeFolder");this._success(e,d)}else{this._notify(e,d)}}else{this._fail(e,d)}},setFile:function(e,d){var g=this;d=this._options(d,function(){g._trigger(e,"fileset")},null,function(){g._trigger(e,"wasfile")});if(this.isItem(e)){if(this.isFolder(e)){var f=function(){e.first().removeClass("aciTreeFolder aciTreeFolderMaybe aciTreeOpen").addClass("aciTreeFile");g._success(e,d)};if(this.wasLoad(e)){this.unload(e,{success:f,fail:d.fail,unanimated:d.unanimated})}else{f()}}else{this._notify(e,d)}}else{this._fail(e,d)}},setIcon:function(g,f){if(this.isItem(g)){var d=this.itemData(g);var i=d.props.icon;var e=g.first().children(".aciTreeItem");var h=e.children(".aciTreeIcon");if(h.length){if(f){if(f instanceof Array){h.attr("class","aciTreeIcon "+f[0]).css("background-position",f[1]+"px "+f[2]+"px")}else{h.attr("class","aciTreeIcon "+f)}d.props.icon=f;this._trigger(g,"iconset",{oldIcon:i})}else{h.remove();d.props.icon=null;this._trigger(g,"iconremoved",{oldIcon:i})}}else{if(f){if(f instanceof Array){e.prepend('<div class="aciTreeIcon '+f[0]+'" style="background-position:'+f[1]+"px "+f[2]+'px"></div>')}else{e.prepend('<div class="aciTreeIcon '+f+'"></div>')}d.props.icon=f;this._trigger(g,"iconset",{oldIcon:i})}else{this._trigger(g,"noticon")}}return true}return false},setText:function(g,f){if(this.isItem(g)){var e=this.itemData(g);var d=e.item;g.first().children(".aciTreeItem").find(".aciTreeText").html(f);e.item=f;this._trigger(g,"textset",{oldText:d});return true}return false},isOpen:function(d){return d&&d.first().hasClass("aciTreeOpen")},isClosed:function(d){return !this.isOpen(d)},hasChildrens:function(d){if(!d){d=this._instance.jQuery}return d.first().children(".aciTreeUl").children(".aciTreeLi:first").length>0},hasSiblings:function(d){return d&&(d.first().siblings(".aciTreeLi:first").length>0)},hasPrev:function(d){return this.prev(d).length>0},hasNext:function(d){return this.next(d).length>0},siblings:function(d){return d?d.first().siblings(".aciTreeLi"):b([])},prev:function(d){return d?d.first().prev(".aciTreeLi"):b([])},next:function(d){return d?d.first().next(".aciTreeLi"):b([])},level:function(d){var e=-1;if(d){d=d.first();while(d.hasClass("aciTreeLi")){d=d.parent().parent();e++}}return e},getId:function(e){var d=this.itemData(e);return d?d.id:null},itemData:function(d){return d?d.first().data("itemData"+this._instance.nameSpace):null},setId:function(e,g){if(this.isItem(e)){var d=this.itemData(e);var f=d.id;d.id=g;this._trigger(e,"idset",{oldId:f});return true}return false},getIndex:function(d){return d?d.first().parent().children(".aciTreeLi").index(d.first()):null},getText:function(e){var d=this.itemData(e);return d?d.item:null},isItem:function(d){return d&&d.first().hasClass("aciTreeLi")},_animate:function(g,h,f,i){if(!g){g=this._instance.jQuery}if(!f){var e=h?this._instance.options.show:this._instance.options.hide;if(e){var d=g.first().children(".aciTreeUl");if(d.length){d.stop(true,true).animate(e.props,{duration:e.duration,easing:e.easing,complete:i})}else{if(i){i()}}return}}g.first().children(".aciTreeUl").stop(true,true).toggle(h);if(i){i()}},first:function(d){if(!d){d=this._instance.jQuery}return d.first().children(".aciTreeUl").children(".aciTreeLi:first")},last:function(d){if(!d){d=this._instance.jQuery}return d.first().children(".aciTreeUl").children(".aciTreeLi:last")},isBusy:function(d){if(d){return d.first().hasClass("aciTreeLoad")}else{return !this._private.loadQueue.empty()}},_loading:function(d,e){if(d){d.first().toggleClass("aciTreeLoad",e)}else{if(e){this._loader(e)}}},_loader:function(d){var e=this;if(d||this.isBusy()){if(!this._private.loaderInterval){this._private.loaderInterval=setInterval(function(){e._loader()},this._instance.options.loaderDelay)}this._instance.jQuery.toggleClass("aciTreeLoad",true);clearTimeout(this._private.loaderHide);this._private.loaderHide=setTimeout(function(){e._instance.jQuery.toggleClass("aciTreeLoad",false)},this._instance.options.loaderDelay*2)}},isChildren:function(e,d){if(!e){e=this._instance.jQuery}return d&&e.has(d)},isImmediateChildren:function(e,d){if(!e){e=this._instance.jQuery}return d&&e.children(".aciTreeUl").children(".aciTreeLi").is(d)},sameParent:function(f,d){if(f&&d){var g=this.parent(f);var e=this.parent(d);return(!g.length&&!e.length)||(g.get(0)==e.get(0))}return false},sameTopParent:function(f,d){if(f&&d){var g=this.topParent(f);var e=this.topParent(d);return(!g.length&&!e.length)||(g.get(0)==e.get(0))}return false},destroy:function(){var e=this;if(!this.wasInit()){this._trigger(null,"notinit");return false}if(this.isLocked()){this._trigger(null,"locked");return false}this._instance.locked=true;this._instance.jQuery.toggleClass("aciTreeLoad",true);this._private.loadQueue.destroy();e._destroyHook(false);var d=this._super;this.unload(null,{success:function(){clearTimeout(e._private.loaderHide);clearInterval(e._private.loaderInterval);e._destroyHook(true);e._instance.jQuery.unbind(e._instance.nameSpace).off(e._instance.nameSpace,".aciTreeButton");e._instance.jQuery.toggleClass("aciTreeLoad",false);e._instance.locked=false;d.apply(e);e._trigger(null,"destroyed")},fail:function(){e._instance.jQuery.toggleClass("aciTreeLoad",false);e._instance.locked=false;e._trigger(null,"destroyfail")}});return true},_destroyHook:function(d){}};aciPluginClass.plugins.aciTree=aciPluginClass.aciPluginUi.extend(c,"aciTreeCore");aciPluginClass.publish("aciTree",a)})(jQuery);

// utils
(function(b){var a={__extend:function(){b.extend(this._private,{branchQueue:new this._queue(null,true,this._instance.options.queueDelay)});this._super()},update:function(d,c){var f=this;c=this._options(c,function(){f._trigger(d,"updated")},function(){f._trigger(d,"updatefail")});if(this.isItem(d)){if(c.itemData.props&&(c.itemData.props.isFolder||(c.itemData.props.isFolder===null))){var e=function(){f.setId(d,c.itemData.id);f.setText(d,c.itemData.item);if(c.itemData.props){f.setIcon(d,c.itemData.props.icon)}d.first().removeClass("aciTreeFolder aciTreeFolderMaybe").addClass((c.itemData.props.isFolder||(c.itemData.items&&c.itemData.items.length))?"aciTreeFolder":"aciTreeFolderMaybe");if(c.itemData.items){if(f.wasLoad(d)){f.unload(d,{success:function(){f.loadFrom(d,{success:c.success,fail:c.fail,itemData:c.itemData.items})},fail:c.fail,unanimated:c.unanimated})}else{f.loadFrom(d,{success:c.success,fail:c.fail,itemData:c.itemData.items})}}else{f._success(d,c)}};if(this.isFolder(d)){e()}else{this.setFolder(d,{success:e,fail:c.fail})}}else{var e=function(){f.setId(d,c.itemData.id);f.setText(d,c.itemData.item);if(c.itemData.props){f.setIcon(d,c.itemData.props.icon)}};if(this.isFile(d)){e()}else{this.setFile(d,{success:e,fail:c.fail})}}}else{this._fail(d,c)}},branch:function(c,h,d){var g=this;var f=this._private;var e=function(j,l,i){var k=i?g.next(j):g.first(j);if(k.length){if(g.isFolder(k)){if(g.wasLoad(k)){f.branchQueue.push(function(){l(g,k);e(k,l);e(k,l,true)}).run()}else{if(d){f.branchQueue.push(function(m){g.ajaxLoad(k,{success:function(){l(g,k);e(k,l);e(k,l,true);m()},fail:function(){e(k,l,true);m()}})},true).run()}else{f.branchQueue.push(function(){l(g,k);e(k,l,true)}).run()}}}else{f.branchQueue.push(function(){l(g,k);e(k,l,true)}).run()}}};e(c,h)},isBusy:function(c){if(c){return this._super(c)}else{return this._super(c)||!this._private.branchQueue.empty()}},swap:function(d,c){if(this.isItem(d)&&this.isItem(c)&&!this.isChildren(d,c)&&!this.isChildren(c,d)&&(d.get(0)!=c.get(0))){d=d.first();c=c.first();var g=this.prev(d);if(g.length){if(c.get(0)==g.get(0)){c.before(d)}else{d.insertAfter(c);c.insertAfter(g)}}else{var f=this.next(d);if(f.length){if(c.get(0)==f.get(0)){c.after(d)}else{d.insertAfter(c);c.insertBefore(f)}}else{var e=d.parent();d.insertAfter(c);e.append(c)}}this._trigger(null,"swapped",{item1:d,item2:c});return true}else{this._trigger(null,"swapfail")}return false},moveUp:function(d){if(this.isItem(d)){var c=this.prev(d);var e=this.getIndex(d);if(c.length){c.before(d.first())}this._trigger(d,"movedup",{oldIndex:e});return true}return false},moveDown:function(d){if(this.isItem(d)){var c=this.next(d);var e=this.getIndex(d);if(c.length){c.after(d.first())}this._trigger(d,"moveddown",{oldIndex:e});return true}return false},moveFirst:function(d){if(this.isItem(d)){var c=this.parent(d);if(!c.length){c=this._instance.jQuery}var e=this.getIndex(d);c.children(".aciTreeUl").prepend(d.first());this._trigger(d,"movedfirst",{oldIndex:e});return true}return false},moveLast:function(d){if(this.isItem(d)){var c=this.parent(d);if(!c.length){c=this._instance.jQuery}var e=this.getIndex(d);c.children(".aciTreeUl").append(d.first());this._trigger(d,"movedlast",{oldIndex:e});return true}return false},_search:function(k,g){var j=this.childrens(k);var l,c,e,n,h=false;for(var f=0,m=j.length;f<m;f++){l=j.eq(f);c=String(this.getId(l));e=c.length;if(e){if(c==g.substr(0,e)){n=l;h=g.length==e;break}}}if(n){if(!h){var d=this._search(n,g);if(d){return d}}return{item:n,exact:h}}else{return null}},searchId:function(j,h,f,c){var i=this;c=this._options(c);if(j){if(h){if(f){var g=function(k){var l=i._search(k,j);if(l){if(l.exact){i._success(l.item,c)}else{if(i.wasLoad(l.item)){i._fail(k,c)}else{i.ajaxLoad(l.item,{success:function(){g(l.item)},fail:c.fail})}}}else{i._fail(k,c)}};g();return b([])}else{var e=this._search(null,j);if(e&&e.exact){this._success(e,c);return e.item}}}else{var d=[];this._instance.jQuery.find(".aciTreeLi").each(function(){if(j==i.getId(b(this))){d[d.length]=this}});if(d.length){var e=b(d);this._success(e,c,e);return e}}}this._fail(null,c);return b([])},_destroyHook:function(c){if(!c){this._private.branchQueue.destroy()}this._super(c)}};aciPluginClass.plugins.aciTree=aciPluginClass.plugins.aciTree.extend(a,"aciTreeUtils")})(jQuery);

// selectable
(function(b){var a={selectable:true,textSelection:false};var c={__extend:function(){b.extend(this._instance,{focus:false});b.extend(this._private,{blurTimeout:null,focus:null});this._super()},hasFocus:function(){return this._instance.focus},_lastFocus:function(){return(this._instance.focus&&this._private.focus)?this._private.focus:b([])},_focus:function(d){clearTimeout(this._private.blurTimeout);this._private.focus=d;if(!this._instance.focus){this._instance.focus=true;this._instance.jQuery.addClass("aciTreeFocus");this._trigger(null,"focused")}},_blur:function(){var d=this;clearTimeout(this._private.blurTimeout);this._private.blurTimeout=setTimeout(function(){if(d._instance.focus){d._instance.focus=false;d._instance.jQuery.removeClass("aciTreeFocus");d._trigger(null,"blurred")}},10)},_initSelectable:function(){var d=this;if(typeof this._instance.jQuery.attr("tabindex")=="undefined"){this._instance.jQuery.attr("tabindex",0)}this._instance.jQuery.bind("focusin"+this._private.nameSpace,function(f){d._focus(b(f.target))}).bind("focusout"+this._private.nameSpace,function(){d._blur()}).bind("keydown"+this._private.nameSpace,function(h){if(!d._instance.focus){return}var f=d.selected();if(f.length&&d.isBusy(f)){return false}var g=b([]);switch(h.which){case 38:g=f.length?d._prevOpen(f):d.first();break;case 40:g=f.length?d._nextOpen(f):d.first();break;case 37:if(f.length){if(d.isOpen(f)){d.close(f,{collapse:d._instance.options.collapse,expand:d._instance.options.expand,unique:d._instance.options.unique})}else{g=d.parent(f)}}else{g=d.first()}break;case 39:if(f.length){if(d.isFolder(f)&&d.isClosed(f)){d.open(f,{collapse:d._instance.options.collapse,expand:d._instance.options.expand,unique:d._instance.options.unique})}else{g=d.first(f)}}else{g=d.first()}break;case 33:g=f.length?d._prevPage(f):d.first();break;case 34:g=f.length?d._nextPage(f):d.first();break;case 36:g=d.first();break;case 35:g=d._lastOpen();break;case 13:if(f.length&&d.isFolder(f)&&d.isClosed(f)){d.open(f,{collapse:d._instance.options.collapse,expand:d._instance.options.expand,unique:d._instance.options.unique})}break;case 27:if(f.length&&d.isOpen(f)){d.close(f,{collapse:d._instance.options.collapse,expand:d._instance.options.expand,unique:d._instance.options.unique})}break;case 32:if(f.length&&d.isFolder(f)){d.toggle(f,{collapse:d._instance.options.collapse,expand:d._instance.options.expand,unique:d._instance.options.unique})}break}if(g.length){if(!d.isSelected(g)){if(!d.isVisible(g)){d.setVisible(g)}d.select(g,true);return false}else{if(!d.isVisible(g)){d.setVisible(g);return false}}}}).on("click"+this._private.nameSpace,".aciTreeItem",function(g){var f=d.itemFrom(g.target);if(!d.isVisible(f)){d.setVisible(f)}if(!d.isSelected(f)){d.select(f,true)}}).on("dblclick"+this._private.nameSpace,".aciTreeItem",function(g){var f=d.itemFrom(g.target);if(d.isFolder(f)){d.toggle(f,{collapse:d._instance.options.collapse,expand:d._instance.options.expand,unique:d._instance.options.unique})}})},_initHook:function(){if(this._instance.options.selectable){this._initSelectable()}this._super()},_itemHook:function(e,f,d,g){if(!this._instance.options.textSelection){this._selectable(f.children(".aciTreeItem"))}this._super(e,f,d,g)},_selectable:function(d,e){if(e){d.css({"-webkit-user-select":"text","-moz-user-select":"text","-ms-user-select":"text","-o-user-select":"text","user-select":"text"}).attr({unselectable:null,onselectstart:null}).unbind("selectstart"+this._private.nameSpace)}else{d.css({"-webkit-user-select":"none","-moz-user-select":"-moz-none","-ms-user-select":"none","-o-user-select":"none","user-select":"none"}).attr({unselectable:"on",onselectstart:"return false"}).bind("selectstart"+this._private.nameSpace,function(){return true})}},_lastOpen:function(d){var f=this;var e=function(h){var g=f.last(h);if(f.isOpen(g)){return e(g)}else{return g}};if(!d){d=this.last()}if(this.isOpen(d)){return e(d)}else{return d}},_prevOpen:function(f){var e=this.prev(f);if(e.length){return this._lastOpen(e)}else{var d=this.parent(f);return d.length?d:f}},_nextOpen:function(e){var g=this;var f=function(j){var i=g.parent(j);if(i.length){var h=g.next(i);if(h.length){return h}else{return f(i)}}return null};if(this.isOpen(e)){return this.first(e)}else{var d=this.next(e);if(d.length){return d}else{d=f(e);return d?d:e}}},_itemHeight:function(e){var d=e.first().children(".aciTreeItem");return d.outerHeight(true)},_prevPage:function(g){var d=this._itemHeight(g);var h=this._instance.jQuery.height();var f=b([]),e=g;do{e=this._prevOpen(e);if(e.length){if(e.get(0)==f.get(0)){break}d+=this._itemHeight(e);f=e}else{break}}while(d<h);return e},_nextPage:function(g){var d=this._itemHeight(g);var h=this._instance.jQuery.height();var f=b([]),e=g;do{e=this._nextOpen(e);if(e.length){if(e.get(0)==f.get(0)){break}d+=this._itemHeight(e);f=e}else{break}}while(d<h);return e},_selectHook:function(d){},select:function(e,f){var h=this;var d=this._instance.jQuery.find(".aciTreeSelected");if(e&&f){d=d.not(e)}var g=this.selected();d.removeClass("aciTreeSelected").each(function(){h._trigger(b(this),"unselected")});if(f&&this.isItem(e)){if(this.isSelected(e)){this._trigger(e,"wasselected")}else{e.first().addClass("aciTreeSelected");this._trigger(e,"selected",{oldSelected:g});this._selectHook(g)}}},selected:function(){return this._instance.jQuery.find(".aciTreeSelected:first")},isSelected:function(d){return d&&d.first().hasClass("aciTreeSelected")},option:function(d,e){var f=this;if(this.wasInit()&&!this.isLocked()){if((d=="selectable")&&(e!=this._instance.options.selectable)){if(e){this._initSelectable()}else{this._doneSelectable()}}if((d=="textSelection")&&(e!=this._instance.options.textSelection)){if(e){this._instance.jQuery.find(".aciTreeItem").each(function(){f._selectable(b(this),true)})}else{this._instance.jQuery.find(".aciTreeItem").each(function(){f._selectable(b(this))})}}}this._super(d,e)},_doneSelectable:function(d){if(this._instance.jQuery.attr("tabindex")=="0"){this._instance.jQuery.removeAttr("tabindex")}this._instance.jQuery.unbind(this._private.nameSpace);this._instance.jQuery.off(this._private.nameSpace,".aciTreeItem");this._instance.jQuery.removeClass("aciTreeFocus");this._instance.focus=false;if(!d){var e=this.selected();if(e.length){this.select(e,false)}}},_destroyHook:function(d){if(d){this._doneSelectable(true)}this._super(d)}};aciPluginClass.plugins.aciTree=aciPluginClass.plugins.aciTree.extend(c,"aciTreeSelectable");aciPluginClass.defaults("aciTree",a)})(jQuery);

// checkbox
(function(c){var b={checkbox:false,checkboxName:"check[]"};var a={_initCheckbox:function(){var d=this;this._instance.jQuery.bind("acitree"+this._private.nameSpace,function(i,f,g,h){switch(h.event){case"loaded":if(g){d._loadCheckbox(g)}break;case"focused":d._checkbox(d.selected()).focus();break;case"selected":d._checkbox(g).focus();break}}).bind("keydown"+this._private.nameSpace,function(g){switch(g.which){case 9:case 32:if(d.isSelected){var f=d.selected();if(d.hasCheckbox(f)){if(d._lastFocus().get(0)==d._instance.jQuery.get(0)){d._checkbox(f).focus().trigger(g)}g.stopImmediatePropagation()}}break}}).on("click"+this._private.nameSpace,".aciTreeItem",function(g){if(c(g.target).hasClass("aciTreeItem")){var f=d.itemFrom(g.target);if(d.hasCheckbox(f)){d._checkbox(f).focus();d.check(f,!d.isChecked(f));g.preventDefault()}}}).on("focus"+this._private.nameSpace,"input[type=checkbox]",function(g){var f=d.itemFrom(g.target);if(d.isSelected&&!d.isSelected(f)){d.select(f,true)}}).on("click"+this._private.nameSpace,"input[type=checkbox]",function(g){var f=d.itemFrom(g.target);d.check(f,c(this).is(":checked"))}).on("keydown"+this._private.nameSpace,"input[type=checkbox]",function(g){switch(g.which){case 38:case 40:case 37:case 39:case 33:case 34:case 36:case 35:case 13:case 27:g.preventDefault();break;case 9:case 32:if(d.isSelected){var f=d.itemFrom(g.target);if(!d.isSelected(f)){return false}}g.stopPropagation();break}})},_checkbox:function(d){return d?d.first().children(".aciTreeItem").find("input[type=checkbox]"):c([])},_initHook:function(){if(this._instance.options.checkbox){this._initCheckbox()}this._super()},_itemHook:function(f,g,d,h){if(this._instance.options.checkbox){var e=this.hasRadio&&this.hasRadio(g);if(!e&&((d.props&&d.props.checkbox)||!d.props||(typeof d.props.checkbox=="undefined"))){this._addCheckbox(g,d)}}this._super(f,g,d,h)},_selectHook:function(f){var d=this._super(f);if((typeof d!="undefined")&&!d){return false}var e=this.selected();if(!this.hasCheckbox(e)&&this.hasCheckbox(f)){var g=this._checkbox(f);if(g.is(":focus")){g.blur();this._instance.jQuery.focus();return false}}},_addCheckbox:function(f,d){var e=d.props&&d.props.checkboxName?d.props.checkboxName:this._instance.options.checkboxName;f.first().addClass("aciTreeCheckbox").children(".aciTreeItem").find(".aciTreeText").wrap("<label></label>").before('<input type="checkbox" name="'+e+'" value="'+this.getId(f)+'"'+(d.props&&d.props.checked?' checked="checked"':"")+" />")},_removeCheckbox:function(e){var d=e.first().removeClass("aciTreeCheckbox").children(".aciTreeItem").find("label");if(d.length){d.find("*").not(".aciTreeText").remove();d.find(".aciTreeText").unwrap()}},setId:function(e,f){var d=this._super(e,f);if(d&&this.hasCheckbox(e)){this._checkbox(e).attr("value",f)}return d},_loadCheckbox:function(d){if(this.hasCheckbox(d)){if(this.isChecked(d)){if(this.checkboxes(this.childrens(d),true).length){this._parentCheckbox(d)}else{this._childCheckbox(d)}}else{this._childCheckbox(d)}}},_childCheckbox:function(d){var g=this;var e=this._checkbox(d).removeClass("aciTreeTristate").is(":checked");var f=function(h){g.checkboxes(g.childrens(h)).each(function(){g._checkbox(c(this)).prop("checked",e).removeClass("aciTreeTristate");f(c(this))})};f(d)},_parentCheckbox:function(d){var e=this;this.path(d,true).each(function(){if(!e.hasCheckbox(c(this))){return false}var h=e.checkboxes(e.childrens(c(this)));if(h.length){var g=e.checkboxes(h,true).length;if(g){var f=(g!=h.length)||(h.find(".aciTreeTristate").length>0);e._checkbox(c(this)).prop("checked",true).toggleClass("aciTreeTristate",f)}else{e._checkbox(c(this)).prop("checked",false).removeClass("aciTreeTristate")}}else{e._checkbox(c(this)).removeClass("aciTreeTristate")}})},hasCheckbox:function(d){return d&&d.hasClass("aciTreeCheckbox")},_stateCheckbox:function(f){var d=this.parent(f);var g=this.checkboxes(this.childrens(f));var e=this.checkboxes(g,true);if(this.hasCheckbox(d)){if(this.isChecked(d)){var h=this.checkboxes(this.siblings(f));if(h.length){if(e.length){this._parentCheckbox(e)}else{this._parentCheckbox(f)}}else{this._checkbox(f).prop("checked",true);this._trigger(f,"checkboxadded");if(g.length&&!e.length){this.check(f,true)}return}}else{if(e.length){this._parentCheckbox(e)}}}else{if(e.length){this._parentCheckbox(e)}}this._trigger(f,"checkboxadded")},setCheckbox:function(e,g,d,f){if(g==this.hasCheckbox(e)){if(g){if(typeof d!="undefined"){this._checkbox(e).attr("name",d?d:this._instance.options.checkboxName);this._trigger(e,"nameset")}if(typeof f!="undefined"){this.check(e,f)}}}else{if(g){if(this.setRadio&&this.hasRadio(e)){this.setRadio(e,false)}this._addCheckbox(e,{id:this.getId(e),props:{hasCheckbox:true,checkboxName:d}});if(typeof f=="undefined"){this._stateCheckbox(e)}else{this._trigger(e,"checkboxadded");this.check(e,f)}}else{this._removeCheckbox(e);this._parentCheckbox(e);this._trigger(e,"checkboxremoved")}}},isChecked:function(d){if(this.hasCheckbox(d)){return this._checkbox(d).is(":checked")}if(this._super){return this._super(d)}return false},check:function(d,e){if(this.hasCheckbox(d)){this._checkbox(d).prop("checked",e);this._childCheckbox(d);this._parentCheckbox(d);this._trigger(d,e?"checked":"unchecked");return true}if(this._super){return this._super(d,e)}return false},checkboxes:function(d,f){var g=this,e=[];if(this._instance.options.checkbox){if(typeof f=="undefined"){return d.filter(".aciTreeCheckbox")}d.filter(".aciTreeCheckbox").each(function(){if(f==g._checkbox(c(this)).is(":checked")){e[e.length]=this}})}return c(e)},option:function(d,e){if(this.wasInit()&&!this.isLocked()){if((d=="checkbox")&&(e!=this._instance.options.checkbox)){if(e){this._initCheckbox()}else{this._doneCheckbox()}}}this._super(d,e)},_doneCheckbox:function(d){var e=this;this._instance.jQuery.unbind(this._private.nameSpace);this._instance.jQuery.off(this._private.nameSpace,".aciTreeItem");this._instance.jQuery.off(this._private.nameSpace,"input[type=checkbox]");if(!d){this.checkboxes(this.childrens(null,true)).each(function(){e.setCheckbox(c(this),false)})}},_destroyHook:function(d){if(d){this._doneCheckbox(true)}this._super(d)}};aciPluginClass.plugins.aciTree=aciPluginClass.plugins.aciTree.extend(a,"aciTreeCheckbox");aciPluginClass.defaults("aciTree",b)})(jQuery);

// radio
(function(c){var a={radio:false,radioName:"radio"};var b={_initRadio:function(){var d=this;this._instance.jQuery.bind("acitree"+this._private.nameSpace,function(i,f,g,h){switch(h.event){case"loaded":if(g){d._loadRadio(g)}break;case"focused":d._radio(d.selected()).focus();break;case"selected":d._radio(g).focus();break}}).bind("keydown"+this._private.nameSpace,function(g){switch(g.which){case 9:case 32:if(d.isSelected){var f=d.selected();if(d.hasRadio(f)){if(d._lastFocus().get(0)==d._instance.jQuery.get(0)){d._radio(f).focus().trigger(g)}g.stopImmediatePropagation()}}break}}).on("click"+this._private.nameSpace,".aciTreeItem",function(g){if(c(g.target).hasClass("aciTreeItem")){var f=d.itemFrom(g.target);if(d.hasRadio(f)&&!d.isChecked(f)){d._radio(f).focus();d.check(f,true);g.preventDefault()}}}).on("focus"+this._private.nameSpace,"input[type=radio]",function(g){var f=d.itemFrom(g.target);if(d.isSelected&&!d.isSelected(f)){d.select(f,true)}}).on("click"+this._private.nameSpace,"input[type=radio]",function(g){var f=d.itemFrom(g.target);d.check(f,c(this).is(":checked"))}).on("keydown"+this._private.nameSpace,"input[type=radio]",function(g){switch(g.which){case 38:case 40:case 37:case 39:case 33:case 34:case 36:case 35:case 13:case 27:g.preventDefault();break;case 9:case 32:if(d.isSelected){var f=d.itemFrom(g.target);if(!d.isSelected(f)){return false}}g.stopPropagation();break}})},_radio:function(d){return d.first().children(".aciTreeItem").find("input[type=radio]")},_initHook:function(){if(this._instance.options.radio){this._initRadio()}this._super()},_itemHook:function(e,f,d,h){if(this._instance.options.radio){var g=this.hasCheckbox&&this.hasCheckbox(f);if(!g&&((d.props&&d.props.radio)||!d.props||(typeof d.props.radio=="undefined"))){this._addRadio(e,f,d)}}this._super(e,f,d,h)},_selectHook:function(g){var d=this._super(g);if((typeof d!="undefined")&&!d){return false}var f=this.selected();if(!this.hasRadio(f)&&this.hasRadio(g)){var e=this._radio(g);if(e.is(":focus")){e.blur();this._instance.jQuery.focus();return false}}},_addRadio:function(f,g,d){var i=String(d.id).replace(/[^a-z0-9_-]/ig,"");var e=d.props&&d.props.radioName?d.props.radioName:null;if(!e){var h=this.getId(f);e=this._instance.options.radioName+"-"+(h?String(h).replace(/[^a-z0-9_-]/ig,""):"root")}g.first().addClass("aciTreeRadio").children(".aciTreeItem").find(".aciTreeText").wrap("<label></label>").before('<input type="radio" name="'+e+'" value="'+this.getId(g)+'"'+(d.props&&d.props.checked?' checked="checked"':"")+" />")},_removeRadio:function(e){var d=e.first().removeClass("aciTreeRadio").children(".aciTreeItem").find("label");if(d.length){d.find("*").not(".aciTreeText").remove();d.find(".aciTreeText").unwrap()}},setId:function(e,f){var d=this._super(e,f);if(d&&this.hasRadio(e)){this._radio(e).attr("value",f)}return d},_loadRadio:function(d){if(this.hasRadio(d)){if(this.isChecked(d)){if(!this.radios(this.childrens(d),true).length){this._childRadio(d)}}else{this._childRadio(d)}}},_childRadio:function(d){var g=this;var f=function(i,j){var k=g.radios(g.childrens(i));if(j){var h=g.radios(k,true);if(h.length){f(h,true);k=k.not(h.first())}else{if(k.length){g._radio(k).prop("checked",true);f(k,true);k=k.slice(1)}}}k.each(function(){g._radio(c(this)).prop("checked",false);f(c(this),false)})};var e=this._radio(d).is(":checked");f(d,e)},_parentRadio:function(d){var g=this;var f=function(h){g.radios(g.siblings(h)).each(function(){g._radio(c(this)).prop("checked",false);g._childRadio(c(this))})};f(d);var e=this._radio(d).is(":checked");this.path(d,true).each(function(){if(!g.hasRadio(c(this))){return false}g._radio(c(this)).prop("checked",e);f(c(this))})},hasRadio:function(d){return d&&d.hasClass("aciTreeRadio")},_stateRadio:function(f){var d=this.parent(f);var e=this.radios(this.childrens(f),true);if(this.hasRadio(d)){if(this.isChecked(d)){var g=this.radios(this.siblings(f),true);if(g.length){this._childRadio(f)}else{this._trigger(f,"radioadded");this.check(f,true);return}}else{this._childRadio(f)}}else{if(e.length){this._parentRadio(e)}}this._trigger(f,"radioadded")},setRadio:function(f,e,d,g){if(e==this.hasRadio(f)){if(e){if(typeof d!="undefined"){if(!d){var h=this.getId(this.parent(f));var d=this._instance.options.radioName+"-"+(h?String(h).replace(/[^a-z0-9_-]/ig,""):"root")}this._radio(f).attr("name",d);this._trigger(f,"nameset")}if(typeof g!="undefined"){this.check(f,g)}}}else{if(e){if(this.setCheckbox&&this.hasCheckbox(f)){this.setCheckbox(f,false)}this._addRadio(this.parent(f),f.first(),{id:this.getId(f),props:{hasRadio:true,radioName:d}});if(typeof g=="undefined"){this._stateRadio(f)}else{this._trigger(f,"radioadded");this.check(f,g)}}else{var g=this._radio(f).is(":checked");this._removeRadio(f.first());this._trigger(f,"radioremoved");if(g){this.check(this.radios(this.siblings(f)).first(),true)}}}},isChecked:function(d){if(this.hasRadio(d)){return this._radio(d).is(":checked")}if(this._super){return this._super(d)}return false},check:function(d,e){if(this.hasRadio(d)){this._radio(d).prop("checked",e);this._childRadio(d);this._parentRadio(d);this._trigger(d,e?"checked":"unchecked");return true}if(this._super){return this._super(d,e)}return false},radios:function(d,f){var g=this,e=[];if(this._instance.options.radio){if(typeof f=="undefined"){return d.filter(".aciTreeRadio")}d.filter(".aciTreeRadio").each(function(){if(f==g._radio(c(this)).is(":checked")){e[e.length]=this}})}return c(e)},option:function(d,e){if(this.wasInit()&&!this.isLocked()){if((d=="radio")&&(e!=this._instance.options.radio)){if(e){this._initRadio()}else{this._doneRadio()}}}this._super(d,e)},_doneRadio:function(d){var e=this;this._instance.jQuery.unbind(this._private.nameSpace);this._instance.jQuery.off(this._private.nameSpace,".aciTreeItem");this._instance.jQuery.off(this._private.nameSpace,"input[type=radio]");if(!d){this.radios(this.childrens(null,true)).each(function(){e.setRadio(c(this),false)})}},_destroyHook:function(d){if(d){this._doneRadio(true)}this._super(d)}};aciPluginClass.plugins.aciTree=aciPluginClass.plugins.aciTree.extend(b,"aciTreeRadio");aciPluginClass.defaults("aciTree",a)})(jQuery);
